#!/bin/bash
# Usage: generate_rviz_config.sh <package_name> <pkg_dir> <robot1> [<robot2> ...]


PACKAGE_NAME="$1"
PKG_DIR="$2"
OUT_FILE="${PKG_DIR}/config/${PACKAGE_NAME}.rviz"
shift 2
# Initialize ROBOTS array from remaining arguments
ROBOTS=("$@")



{
  echo "Panels:"
  echo "  - Class: rviz_common/Displays"
  echo "    Help Height: 85"
  echo "    Name: Displays"
  echo "    Property Tree Widget:"
  echo "      Expanded:"
  echo "        - /Global Options1"
  echo "        - /Status1"
  echo "      Splitter Ratio: 0.5"
  echo "    Tree Height: 384"
  echo "  - Class: rviz_common/Selection"
  echo "    Name: Selection"
  echo "  - Class: rviz_common/Tool Properties"
  echo "    Expanded:"
  echo "      - /2D Goal Pose1"
  echo "      - /Publish Point1"
  echo "    Name: Tool Properties"
  echo "    Splitter Ratio: 0.5886790156364441"
  echo "  - Class: rviz_common/Views"
  echo "    Expanded:"
  echo "      - /Current View1"
  echo "    Name: Views"
  echo "    Splitter Ratio: 0.5"
  echo "  - Class: rviz_common/Time"
  echo "    Experimental: false"
  echo "    Name: Time"
  echo "    SyncMode: 0"
  echo "    SyncSource: \"\""
  echo "Visualization Manager:"
  echo "  Class: \"\""
  echo "  Displays:"
  echo "    - Alpha: 0.5"
  echo "      Cell Size: 1"
  echo "      Class: rviz_default_plugins/Grid"
  echo "      Color: 160; 160; 164"
  echo "      Enabled: true"
  echo "      Line Style:"
  echo "        Line Width: 0.03"
  echo "        Value: Lines"
  echo "      Name: Grid"
  echo "      Normal Cell Count: 0"
  echo "      Offset:"
  echo "        X: 0"
  echo "        Y: 0"
  echo "        Z: 0"
  echo "      Plane: XY"
  echo "      Plane Cell Count: 10"
  echo "      Reference Frame: <Fixed Frame>"
  echo "      Value: true"
  for robot in "${ROBOTS[@]}"; do
    echo "    - Acceleration_Scaling_Factor: 0.1"
    echo "      Class: moveit_rviz_plugin/MotionPlanning"
    echo "      Enabled: true"
    echo "      Move Group Namespace: \"\""
    echo "      MoveIt_Allow_Approximate_IK: false"
    echo "      MoveIt_Allow_External_Program: false"
    echo "      MoveIt_Allow_Replanning: false"
    echo "      MoveIt_Allow_Sensor_Positioning: false"
    echo "      MoveIt_Planning_Attempts: 10"
    echo "      MoveIt_Planning_Time: 5"
    echo "      MoveIt_Use_Cartesian_Path: false"
    echo "      MoveIt_Use_Constraint_Aware_IK: false"
    echo "      MoveIt_Workspace:"
    echo "        Center:"
    echo "          X: 0"
    echo "          Y: 0"
    echo "          Z: 0"
    echo "        Size:"
    echo "          X: 2"
    echo "          Y: 2"
    echo "          Z: 2"
    echo "      Name: MotionPlanning"
    echo "      Planned Path:"
    echo "        Color Enabled: false"
    echo "        Interrupt Display: false"
    echo "        Links:"
    echo "          All Links Enabled: true"
    echo "          Expand Joint Details: false"
    echo "          Expand Link Details: false"
    echo "          Expand Tree: false"
    echo "          Link Tree Style: Links in Alphabetic Order"
    # For each robot, list standard UR links
    for link in base base_link base_link_inertia flange forearm_link ft_frame shoulder_link tool0 upper_arm_link wrist_1_link wrist_2_link wrist_3_link; do
      echo "          ${robot}_${link}:"
      echo "            Alpha: 1"
      echo "            Show Axes: false"
      echo "            Show Trail: false"
      case "$link" in
        base_link_inertia|shoulder_link|upper_arm_link|forearm_link|wrist_1_link|wrist_2_link|wrist_3_link)
          echo "            Value: true"
          ;;
      esac
    done
    # World frame entry for completeness
    echo "          world:"
    echo "            Alpha: 1"
    echo "            Show Axes: false"
    echo "            Show Trail: false"
    echo "        Loop Animation: false"
    echo "        Robot Alpha: 0.5"
    echo "        Robot Color: 150; 50; 150"
    echo "        Show Robot Collision: false"
    echo "        Show Robot Visual: true"
    echo "        Show Trail: false"
    echo "        State Display Time: 3x"
    echo "        Trail Step Size: 1"
    echo "        Trajectory Topic: /display_planned_path"
    echo "        Use Sim Time: false"
    echo "      Planning Metrics:"
    echo "        Payload: 1"
    echo "        Show Joint Torques: false"
    echo "        Show Manipulability: false"
    echo "        Show Manipulability Index: false"
    echo "        Show Weight Limit: false"
    echo "        TextHeight: 0.08"
    echo "      Planning Request:"
    echo "        Colliding Link Color: 255; 0; 0"
    echo "        Goal State Alpha: 1"
    echo "        Goal State Color: 250; 128; 0"
    echo "        Interactive Marker Size: 0"
    echo "        Joint Violation Color: 255; 0; 255"
    echo "        Planning Group: ${robot}"
    echo "        Query Goal State: true"
    echo "        Query Start State: false"
    echo "        Show Workspace: false"
    echo "        Start State Alpha: 1"
    echo "        Start State Color: 0; 255; 0"
    echo "      Planning Scene Topic: /monitored_planning_scene"
    echo "      Robot Description: robot_description"
    echo "      Scene Geometry:"
    echo "        Scene Alpha: 0.9"
    echo "        Scene Color: 50; 230; 50"
    echo "        Scene Display Time: 0.01"
    echo "        Show Scene Geometry: true"
    echo "        Voxel Coloring: Z-Axis"
    echo "        Voxel Rendering: Occupied Voxels"
    echo "      Scene Robot:"
    echo "        Attached Body Color: 150; 50; 150"
    echo "        Links:"
    echo "          All Links Enabled: true"
    echo "          Expand Joint Details: false"
    echo "          Expand Link Details: false"
    echo "          Expand Tree: false"
    echo "          Link Tree Style: Links in Alphabetic Order"
    for link in base base_link base_link_inertia flange forearm_link ft_frame shoulder_link tool0 upper_arm_link wrist_1_link wrist_2_link wrist_3_link; do
      echo "          ${robot}_${link}:"
      echo "            Alpha: 1"
      echo "            Show Axes: false"
      echo "            Show Trail: false"
      case "$link" in
        base_link_inertia|shoulder_link|upper_arm_link|forearm_link|wrist_1_link|wrist_2_link|wrist_3_link)
          echo "            Value: true"
          ;;
      esac
    done
    echo "          world:"
    echo "            Alpha: 1"
    echo "            Show Axes: false"
    echo "            Show Trail: false"
    echo "        Robot Alpha: 1"
    echo "        Show Robot Collision: false"
    echo "        Show Robot Visual: true"
    echo "      Value: true"
    echo "      Velocity_Scaling_Factor: 0.1"
  done
  echo "  Enabled: true"
  echo "  Global Options:"
  echo "    Background Color: 48; 48; 48"
  echo "    Fixed Frame: world"
  echo "    Frame Rate: 30"
  echo "  Name: root"
  echo "  Tools:"
  echo "    - Class: rviz_default_plugins/Interact"
  echo "      Hide Inactive Objects: true"
  echo "    - Class: rviz_default_plugins/MoveCamera"
  echo "    - Class: rviz_default_plugins/Select"
  echo "    - Class: rviz_default_plugins/FocusCamera"
  echo "    - Class: rviz_default_plugins/Measure"
  echo "      Line color: 128; 128; 0"
  echo "    - Class: rviz_default_plugins/SetInitialPose"
  echo "      Covariance x: 0.25"
  echo "      Covariance y: 0.25"
  echo "      Covariance yaw: 0.06853891909122467"
  echo "      Topic:"
  echo "        Depth: 5"
  echo "        Durability Policy: Volatile"
  echo "        History Policy: Keep Last"
  echo "        Reliability Policy: Reliable"
  echo "        Value: /initialpose"
  echo "    - Class: rviz_default_plugins/SetGoal"
  echo "      Topic:"
  echo "        Depth: 5"
  echo "        Durability Policy: Volatile"
  echo "        History Policy: Keep Last"
  echo "        Reliability Policy: Reliable"
  echo "        Value: /goal_pose"
  echo "    - Class: rviz_default_plugins/PublishPoint"
  echo "      Single click: true"
  echo "      Topic:"
  echo "        Depth: 5"
  echo "        Durability Policy: Volatile"
  echo "        History Policy: Keep Last"
  echo "        Reliability Policy: Reliable"
  echo "        Value: /clicked_point"
  echo "  Transformation:"
  echo "    Current:"
  echo "      Class: rviz_default_plugins/TF"
  echo "  Value: true"
  echo "  Views:"
  echo "    Current:"
  echo "      Class: rviz_default_plugins/Orbit"
  echo "      Distance: 8.167291641235352"
  echo "      Enable Stereo Rendering:"
  echo "        Stereo Eye Separation: 0.06"
  echo "        Stereo Focal Distance: 1"
  echo "        Swap Stereo Eyes: false"
  echo "        Value: false"
  echo "      Focal Point:"
  echo "        X: 0"
  echo "        Y: 0"
  echo "        Z: 0"
  echo "      Focal Shape Fixed Size: true"
  echo "      Focal Shape Size: 0.05"
  echo "      Invert Z Axis: false"
  echo "      Name: Current View"
  echo "      Near Clip Distance: 0.01"
  echo "      Pitch: 1.01"
  echo "      Target Frame: <Fixed Frame>"
  echo "      Value: Orbit (rviz)"
  echo "      Yaw: 2.39"
  echo "    Saved: ~"
  echo "Window Geometry:"
  echo "  Displays:"
  echo "    collapsed: false"
  echo "  Height: 1283"
  echo "  Hide Left Dock: false"
  echo "  Hide Right Dock: false"
  echo "  MotionPlanning:"
  echo "    collapsed: false"
  echo "  MotionPlanning - Trajectory Slider:"
  echo "    collapsed: false"
  echo "  QMainWindow State: 000000ff00000000fd00000004000000000000024e00000454fc020000000bfb0000001200530065006c0065006300740069006f006e00000001e10000009b0000006e00fffffffb0000001e0054006f006f006c002000500072006f007000650072007400690065007302000001ed000001df00000185000000a3fb000000120056006900650077007300200054006f006f02000001df000002110000018500000122fb000000200054006f006f006c002000500072006f0070006500720074006900650073003203000002880000011d000002210000017afb000000100044006900730070006c00610079007301000000470000021c000000f100fffffffb0000002000730065006c0065006300740069006f006e00200062007500660066006500720200000138000000aa0000023a00000294fb00000014005700690064006500530074006500720065006f02000000e6000000d2000003ee0000030bfb0000000c004b0069006e0065006300740200000186000001060000030c00000261fb000000280020002d0020005400720061006a006500630074006f0072007900200053006c00690064006500720000000000ffffffff0000000000000000fb00000044004d006f00740069006f006e0050006c0061006e006e0069006e00670020002d0020005400720061006a006500630074006f0072007900200053006c00690064006500720000000000ffffffff0000004d00fffffffb0000001c004d006f00740069006f006e0050006c0061006e006e0069006e0067010000026a00000231000001bd00ffffff000000010000010f00000454fc0200000003fb0000001e0054006f006f006c002000500072006f00700065007200740069006500730100000041000000780000000000000000fb0000000a00560069006500770073010000004700000454000000c200fffffffb0000001200530065006c0065006300740069006f006e010000025a000000b200000000000000000000000200000490000000a9fc0100000001fb0000000a00560069006500770073030000004e00000080000002e10000019700000003000007c800000040fc0100000002fb0000000800540069006d00650100000000000007c80000038100fffffffb0000000800540069006d006501000000000000045000000000000000000000045d0000045400000004000000040000000800000008fc0000000100000002000000010000000a0054006f006f006c00730100000000ffffffff0000000000000000"
  echo "  Selection:"
  echo "    collapsed: false"
  echo "  Time:"
  echo "    collapsed: false"
  echo "  Tool Properties:"
  echo "    collapsed: false"
  echo "  Views:"
  echo "    collapsed: false"
  echo "  Width: 1992"
  echo "  X: 1548"
  echo "  Y: 826"
} > "$OUT_FILE"

echo "Generated RViz config: $OUT_FILE"

echo "Generated RViz config: $OUT_FILE"
